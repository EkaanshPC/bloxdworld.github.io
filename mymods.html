<!DOCTYPE html>
<html lang="en">
<head>
<!-- 🎨 Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fredoka&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<!-- 🖼️ Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png">
<link rel="apple-touch-icon" href="https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png">

<!-- ⚡ Meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="uwGK_wrZ8HW1YDPlIVdaqyOErueoMH5-9DF-fXL7uSc" />
<title>Upload a mod | Bloxd World</title>
<meta name="description" content="Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd. Built by NeonJet Studios.">
<meta name="keywords" content="BloxdWorld, Bloxd mods, Bloxd.io mods, NeonJet Studios, ObiloxYT, modding, leaderboards">
<meta name="author" content="NeonJet Studios">

<!-- 🟦 Open Graph (Facebook/Discord) -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="Bloxd World">
<meta property="og:url" content="https://bloxdworld.pages.dev">
<meta property="og:title" content="Bloxd World – Share and Discover Mods">
<meta property="og:description" content="Upload and explore mods for Bloxd. Vote, sort, and share your creations.">
<meta property="og:image" content="https://bloxdworld.pages.dev/THE%20PLACE%20FOR.png">
<meta property="og:image:alt" content="Bloxd World Preview Image">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<!-- 🐦 Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Bloxd World – Share and Discover Mods">
<meta name="twitter:description" content="Upload and explore mods for Bloxd. Vote, sort, and share your creations.">
<meta name="twitter:image" content="https://bloxdworld.pages.dev/THE%20PLACE%20FOR.png">

<!-- 🎨 Theme -->
<meta name="theme-color" content="#00c3ff">

<!-- 🎭 Styles -->
<link rel="stylesheet" href="styles/earth-cube.css">
<link rel="stylesheet" href="styles/header.css">
<link rel="stylesheet" href="styles/devlogandindex.css">
<link rel="stylesheet" href="styles/other.css">
<link rel="stylesheet" href="styles/navbar.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
    .my-mods-container {
  max-width: 900px;
  margin: 2rem auto;
  padding: 1rem;
}

.my-mods-container h2 {
  font-size: 2rem;
  margin-bottom: 1rem;
  text-align: center;
  color: #00c3ff;
}

.mods-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.mod-card {
  background: #1e1e1e;
  color: #fff;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  transition: transform 0.2s;
}

.mod-card:hover {
  transform: translateY(-2px);
}

.mod-card h3 {
  margin: 0;
  font-size: 1.3rem;
}

.mod-card p {
  margin: 0;
  word-wrap: break-word;
  white-space: pre-wrap;
  overflow-wrap: break-word;
}

.mod-card a {
  color: #00c3ff;
  text-decoration: none;
  font-weight: bold;
  margin-top: 0.3rem;
}

.mod-card a:hover {
  text-decoration: underline;
}

.mod-card .delete-btn,
.mod-card .add-version-btn {
  margin-top: 0.5rem;
  padding: 6px 14px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.2s;
}

.mod-card .delete-btn {
  background: #ff4c4c;
  color: #fff;
}

.mod-card .delete-btn:hover {
  background: #e03a3a;
}

.mod-card .add-version-btn {
  background: #00c3ff;
  color: #fff;
}

.mod-card .add-version-btn:hover {
  background: #0099cc;
}

@media (max-width: 600px) {
  .mod-card {
    padding: 12px;
  }

  .mod-card h3 {
    font-size: 1.1rem;
  }

  .mod-card .delete-btn,
  .mod-card .add-version-btn {
    padding: 5px 10px;
    font-size: 0.9rem;
  }
}

</style>
<!-- 📊 Structured Data (SEO JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Bloxd World",
  "url": "https://bloxdworld.pages.dev",
  "description": "Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd.",
  "publisher": {
    "@type": "Organization",
    "name": "NeonJet Studios",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png"
    }
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://bloxdworld.pages.dev/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>


<style>
</style>
</head>
<body>
<div class="modrinth-navbar">
  <div class="header">
    
    <!-- Left: Logo -->
    <div class="header-left">
      <div style="display: flex; align-items: center; height: 100%;">
        <div class="cube-container">
          <div class="cube">
            <div class="face front"></div>
            <div class="face back"></div>
            <div class="face right"></div>
            <div class="face left"></div>
            <div class="face top"></div>
            <div class="face bottom"></div>
          </div>
        </div>
      </div>
      <div class="logo-text">Bloxd<br>World</div>
    </div>

    <!-- Right: Navbar + Auth split -->
    <div class="header-right">
      <div class="navbar-wrapper">
        <ul class="navbar">
          <li class="nav-item">
            <a href="index.html"><i class="fas fa-home"></i><span class="nav-label">Home</span></a>
          </li>
          <li class="nav-item">
            <a href="mods.html"><i class="fas fa-cubes"></i><span class="nav-label">Mods</span></a>
          </li>
          <li class="nav-item">
            <a href="upload.html"><i class="fas fa-upload"></i><span class="nav-label">Upload</span></a>
          </li>
          <li class="nav-item">
            <a href="about.html"><i class="fas fa-info-circle"></i><span class="nav-label">About</span></a>
          </li>
          <li class="nav-item">
            <a href="leaderboard.html"><i class="fas fa-trophy"></i><span class="nav-label">Leaderboard</span></a>
          </li>
          <li class="nav-item">
            <a href="#" id="themeToggle"><i class="fas fa-moon"></i><span class="nav-label">Theme</span></a>
          </li>
        </ul>
      </div>
      <div class="auth-wrapper" id="authArea">
        <!-- Auth content here -->
      </div>
    </div>

  </div>
</div>
<div class="my-mods-container">
  <h2>My Mods</h2>
  <div id="modsList" class="mods-list"></div>
</div>

<footer class="site-footer">
  <p>© NeonJet Studios. <strong>Bloxd World</strong> is made by NeonJet Studios and is not affiliated with Bloxd.io.</p>
  <nav class="footer-links">
    <a href="/about">About</a>
    <a href="/leaderboard">Leaderboard</a>
    <a href="/upload">Submit a Mod</a>
    <a href="https://discord.gg/yourserver" target="_blank">Join Discord (SOON)</a>
  </nav>
</footer>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";


const SUPABASE_URL = "https://pxmsgzfufvwxpnyeobwk.supabase.co";
const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bXNnemZ1ZnZ3eHBueWVvYndrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjU1OTksImV4cCI6MjA2NzM0MTU5OX0.-fRzI_259AIkq60Ck7PcgpX2SThnp8rBwVGglKxgY2U";
const supabase = createClient(SUPABASE_URL, ANON_KEY);

const modsList = document.getElementById("modsList");
import { getUserMods } from "./js/googlelogin.js"
async function fetchAndRenderMods() {
  const { data: { user } } = await supabase.auth.getUser(); 
  if (!user) return;

  const mods = await getUserMods(user.id);
  renderMods(mods);
}

function renderMods(mods) {
  modsList.innerHTML = mods.map(mod => `
    <div class="mod-card" data-id="${mod.id}">
      <h3>${mod.title}</h3>
      <p>${mod.shortdescription || "No description"}</p>
      <a href="${"https://bloxdworld.pages.dev/newfullview?addonid="+mod.id}" target="_blank">Download</a>
      <button class="delete-btn">Delete</button>
      <button class="add-version-btn">Add Version</button>
    </div>
  `).join("");

  modsList.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", async e => {
      const modId = e.target.closest(".mod-card").dataset.id;
      if (confirm("Are you sure you want to delete this mod?")) {
        await deleteMod(modId);
      }
    });
  });

  modsList.querySelectorAll(".add-version-btn").forEach(btn => {
  btn.addEventListener("click", e => {
    const modCard = e.target.closest(".mod-card");
    const modId = modCard.dataset.id;

    // If form already exists, don't add another
    if (modCard.querySelector(".version-form")) return;

    // Create form
    const formHtml = `
      <div class="version-form">
        <input type="text" name="title" placeholder="Proposed Title" value="${modCard.querySelector("h3").textContent}">
        <textarea name="description" placeholder="Proposed Description">${modCard.querySelector("p").textContent}</textarea>
        <input type="text" name="file_path" placeholder="Proposed File Path" value="${modCard.querySelector("a").href}">
        <button class="submit-version-btn">Submit Update</button>
        <button class="cancel-version-btn">Cancel</button>
      </div>
    `;
    modCard.insertAdjacentHTML("beforeend", formHtml);

    // Cancel button
    modCard.querySelector(".cancel-version-btn").addEventListener("click", () => {
      modCard.querySelector(".version-form").remove();
    });

    // Submit button
    modCard.querySelector(".submit-version-btn").addEventListener("click", async () => {
      const form = modCard.querySelector(".version-form");
      const proposedTitle = form.querySelector("input[name='title']").value;
      const proposedDesc = form.querySelector("textarea[name='description']").value;
      const proposedFile = form.querySelector("input[name='file_path']").value;

      const { error } = await supabase.from("versions").insert({
        mod_id: modId,
        proposed_title: proposedTitle,
        proposed_description: proposedDesc,
        proposed_file_path: proposedFile,
        created_at: new Date(),
        approved: false
      });

      if (error) return alert("Failed to submit version: " + error.message);

      alert("Update proposal submitted! Awaiting approval.");
      form.remove();
    });
  });
});
}

async function deleteMod(modId) {
  const { error } = await supabase.from("mod").delete().eq("id", modId);
  if (error) return alert("Failed to delete mod: " + error.message);
  alert("Mod deleted!");
  fetchAndRenderMods();
}

async function createVersion(modId, version) {
  const { error } = await supabase.from("versions").insert({
    mod_id: modId,
    version_name: version,
    created_at: new Date()
  });
  if (error) return alert("Failed to add version: " + error.message);
  alert("Version added!");
}

fetchAndRenderMods();

if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
  document.body.classList.add("mobile");
}

const themeToggle = document.getElementById("themeToggle");
if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark-mode");

themeToggle.addEventListener("click", e => {
  e.preventDefault();
  document.body.classList.toggle("dark-mode");
  localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module" src="js/googlelogin.js"></script>
</body> 
</html>

