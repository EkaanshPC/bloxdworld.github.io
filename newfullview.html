<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="google-site-verification" content="uwGK_wrZ8HW1YDPlIVdaqyOErueoMH5-9DF-fXL7uSc" />
  <title>Bloxd World â€“ Share and Discover Mods</title>
<meta name="description" content="Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd. Built by NeonJet Studios.">
<meta property="og:title" content="Bloxd World â€“ Share and Discover Mods">
<meta property="og:description" content="Upload and explore mods for Bloxd. Vote, sort, and share your creations.">
<meta property="og:image" content="https://bloxdworld.pages.dev/THE PLACE FOR.png">
<meta property="og:url" content="https://bloxdworld.pages.dev">
<meta name="twitter:card" content="summary_large_image">
<link rel="stylesheet" href="styles/earth-cube.css">
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<link rel="stylesheet" href="styles/header.css">
<link rel="stylesheet" href="styles/devlogandindex.css">
<link rel="stylesheet" href="styles/other.css">
<link rel="stylesheet" href="styles/navbar.css">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { font-family:'Fredoka', sans-serif; background:#f5f5f5; margin:0; padding:0; }
.modrinth-style { max-width:900px; margin:40px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 0 24px rgba(0,0,0,0.04); }
.mod-header { display:flex; gap:20px; align-items:center; margin-bottom:20px; }
.mod-icon { width:72px; height:72px; border-radius:12px; object-fit:cover; background:#f0f0f0; }
.mod-title { margin:0; font-size:2em; color:#1a1a1a; }
.mod-meta span { display:inline-block; margin-right:15px; font-size:0.95em; color:#666; }
.description {
  background: #f9f9f9;
  padding: 18px;
  border-radius: 10px;
  border: 1px solid #e0e0e0;
  white-space: pre-wrap;        /* keeps your line breaks */
  word-break: break-word;       /* breaks super long words */
  overflow-wrap: anywhere;      /* ensures content wraps nicely */
  max-width: 100%;              /* never go wider than container */
  max-height: 400px;            /* optional scroll limit */
  overflow-y: auto;             /* scroll if too tall */
  margin-top: 10px;
}
#codeSnippet { background:#282c34; color:#e6e6e6; padding:14px; border-radius:8px; font-family:'Fira Code', monospace; overflow-x:auto; }
#copyButton { margin-top:8px; padding:8px 16px; border:none; border-radius:6px; cursor:pointer; background:#00b894; color:white; }
#copyButton:hover { background:#009e7a; }
.analytics-bars-container { display:flex; gap:15px; align-items:flex-end; height:200px; padding:10px; background:#f0f0f0; border-radius:8px; border:1px solid #e0e0e0; justify-content:center; max-width:100%; overflow-x:auto; margin-top:20px; }
.day-bar-wrapper { display:flex; flex-direction:column; align-items:center; justify-content:flex-end; height:100%; min-width:40px; }
.day-label { font-size:0.8em; color:#555; margin-bottom:5px; flex-shrink:0; }
.progress-bar-container { width:25px; height:100%; background:#ddd; border-radius:5px; overflow:hidden; position:relative; flex-grow:1; margin-bottom:5px; }
.progress-bar-fill { width:100%; height:0%; background:#6a0dad; position:absolute; bottom:0; left:0; transition:height 0.5s ease-in-out; border-radius:5px; }
.day-value { font-size:0.9em; font-weight:bold; color:#333; flex-shrink:0; }
</style>
</head>
<body>
<div class="modrinth-navbar">
  <div class="header">
    <div class="header-left">
<div style="display: flex; align-items: center; height: 100%;">
        <div class="cube-container">
          <div class="cube">
            <div class="face front"></div>
            <div class="face back"></div>
            <div class="face right"></div>
            <div class="face left"></div>
            <div class="face top"></div>
            <div class="face bottom"></div>
          </div>
        </div>
      </div>
      <div class="logo-text"> Bloxd <br>World</div>
    </div>
   <div class="header-right">
  <ul class="navbar">
    <li class="nav-item">
      <a href="index.html">
        <i class="fas fa-home"></i>
        <span class="nav-label">Home</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="mods.html">
        <i class="fas fa-cubes"></i>
        <span class="nav-label">Mods</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="upload.html">
        <i class="fas fa-upload"></i>
        <span class="nav-label">Upload</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="about.html">
        <i class="fas fa-info-circle"></i>
        <span class="nav-label">About</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="leaderboard.html">
        <i class="fas fa-trophy"></i>
        <span class="nav-label">Leaderboard</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="#" id="themeToggle">
        <i class="fas fa-moon"></i>
        <span class="nav-label">Theme</span>
      </a>
    </li>
    <li class="nav-item" id="authArea"></li>
  </ul>
    </div>
  </div>
</div>

<div id="mod-detail-page" class="modrinth-style">
  <div class="mod-header">
    <img src="" alt="Mod Icon" class="mod-icon" id="modIcon">
    <div>
      <h1 class="mod-title" id="modTitle">Loading...</h1>
      <div class="mod-meta">
        <span><strong>Uploaded:</strong> <span id="uploadDate">...</span></span>
        <span><strong>By:</strong> <span id="uploaderName">...</span></span>
        <span><strong>Category:</strong> <span id="category">...</span></span>
      </div>
    </div>
  </div>

  <div class="mod-description">
    <h2>Description</h2>
    <p id="description" class="description">Loading description...</p>
  </div>

  <div class="mod-code">
    <h2>Addon Code</h2>
    <pre id="codeSnippet">Loading code...</pre>
    <button id="copyButton">ðŸ“‹ Copy Code</button>
  </div>

  <div class="analytics-bars-container">
  <div class="day-bar-wrapper">
    <span class="day-label">Day 1</span>
    <div class="progress-bar-container"><div class="progress-bar-fill" id="day1Fill"></div></div>
    <span class="day-value" id="day1Value">N/A</span>
  </div>
  <div class="day-bar-wrapper">
    <span class="day-label">Day 2</span>
    <div class="progress-bar-container"><div class="progress-bar-fill" id="day2Fill"></div></div>
    <span class="day-value" id="day2Value">N/A</span>
  </div>
  <div class="day-bar-wrapper">
    <span class="day-label">Day 3</span>
    <div class="progress-bar-container"><div class="progress-bar-fill" id="day3Fill"></div></div>
    <span class="day-value" id="day3Value">N/A</span>
  </div>
  <div class="day-bar-wrapper">
    <span class="day-label">Day 4</span>
    <div class="progress-bar-container"><div class="progress-bar-fill" id="day4Fill"></div></div>
    <span class="day-value" id="day4Value">N/A</span>
  </div>
  <div class="day-bar-wrapper">
    <span class="day-label">Day 5</span>
    <div class="progress-bar-container"><div class="progress-bar-fill" id="day5Fill"></div></div>
    <span class="day-value" id="day5Value">N/A</span>
  </div>
</div>

</div>

<script type="module">
  Toastify({
  text: "This is still in alpha testing!",
  duration: 3000,
  gravity: "bottom", // bottom or top
  position: "right", // left, center, right
  backgroundColor: "linear-gradient(to right, #FF0000, #D3D3D3)",
  close: true,
}).showToast();
const supabaseUrl = "https://pxmsgzfufvwxpnyeobwk.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bXNnemZ1ZnZ3eHBueWVvYndrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjU1OTksImV4cCI6MjA2NzM0MTU5OX0.-fRzI_259AIkq60Ck7PcgpX2SThnp8rBwVGglKxgY2U";
const client = supabase.createClient(supabaseUrl, supabaseKey);

function formatDescription(raw) {
  if(!raw) return 'No description provided.';
  return raw.replace(/\n/g,'<br>')
            .replace(/\*(.*?)\*/g,'<strong>$1</strong>')
            .replace(/_(.*?)_/g,'<u>$1</u>')
            .replace(/`(.*?)`/g,'<code>$1</code>');
}

function updateAnalytics(mod) {
  const fills = Array.from({ length: 5 }, (_, i) => document.getElementById(`day${i + 1}Fill`));
  const values = Array.from({ length: 5 }, (_, i) => document.getElementById(`day${i + 1}Value`));

  let analytics = {};
  try {
    analytics = mod.mod_analytics ? JSON.parse(mod.mod_analytics) : {};
  } catch {
    Toastify({
  text: "Warning: Invalid JSON in mod_analytics!",
  duration: 3000,
  gravity: "bottom", // bottom or top
  position: "right", // left, center, right
  backgroundColor: "linear-gradient(to right, #FFFF00, #D3D3D3)",
  close: true,
}).showToast();
    console.warn("Invalid JSON in mod_analytics");
  }

  // Get day numbers and sort ascending
  const dayEntries = Object.entries(analytics)
    .map(([k, v]) => {
      const match = k.match(/^Day (\d+)$/);
      return match ? [parseInt(match[1], 10), v] : null;
    })
    .filter(Boolean)
    .sort((a, b) => a[0] - b[0]);

  // Take the last 5 days
  const lastFive = Array(5).fill("N/A");
  const sliceStart = Math.max(dayEntries.length - 5, 0);
  dayEntries.slice(sliceStart).forEach(([day, val], i) => {
    lastFive[5 - (dayEntries.length - sliceStart) + i] = val;
  });

  const numericValues = lastFive.filter(v => typeof v === "number" && !isNaN(v));
  const max = numericValues.length ? Math.max(...numericValues) : 0;

  lastFive.forEach((val, i) => {
    fills[i].style.height = typeof val === "number" && max ? (val / max * 100) + "%" : "0%";
    values[i].textContent = val;
  });
}

document.addEventListener("DOMContentLoaded", async ()=>{
  const params = new URLSearchParams(window.location.search);
  const addonId = params.get("addonid");
  if(!addonId) {
    Toastify({
  text: "No AddonId found in URL!",
  duration: 3000,
  gravity: "bottom", // bottom or top
  position: "right", // left, center, right
  backgroundColor: "linear-gradient(to right, #FF0000, #D3D3D3)",
  close: true,
}).showToast();
    return console.error("No Addon ID in URL");}

  const { data, error } = await client
    .from("mod")
    .select("*")
    .eq("id", addonId)
    .single();

  if(error) {
    Toastify({
  text: `Error while finding mod: ${error}`,
  duration: 3000,
  gravity: "bottom", // bottom or top
  position: "right", // left, center, right
  backgroundColor: "linear-gradient(to right, #FF0000, #D3D3D3)",
  close: true,
}).showToast();
    return console.error(error);}

  const mod = data;
  console.log("data got! it is:",mod)
  document.getElementById("modTitle").textContent = mod.title;
  document.getElementById("uploadDate").textContent = mod.created_at.split("T")[0];
  document.getElementById("uploaderName").textContent = mod.author || "Anonymous";
  document.getElementById("category").textContent = mod.category || "Uncategorized";
  document.getElementById("description").innerHTML = formatDescription(mod.description);
  window.getLink = async (filePath) => {
    const { data } = client.storage.from("mod").getPublicUrl(filePath);
    if (data?.publicUrl) {
      return data;
    }
  };
  const fileUrl = `https://pxmsgzfufvwxpnyeobwk.supabase.co/storage/v1/object/public/mod/${mod.file_path}`;
  fetch(fileUrl)
  .then(res => res.text())
  .then(data => {
console.log(`Code found! ${data}`)
    document.getElementById("codeSnippet").textContent = data;
  });
  document.getElementById("modIcon").src = mod.icon || "https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png";

  updateAnalytics(mod);

  document.getElementById("copyButton").addEventListener("click",()=>{
    navigator.clipboard.writeText('Bloxdworld: soon').then(()=>{Toastify({
  text: "Code copied to clipboard!",
  duration: 3000,
  gravity: "bottom", // bottom or top
  position: "right", // left, center, right
  backgroundColor: "linear-gradient(to right, #ADD8E6, #D3D3D3)",
  close: true,
}).showToast();});
  });
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module" src="js/googlelogin.js"></script>
</body>
</html>
