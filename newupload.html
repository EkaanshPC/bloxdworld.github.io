<!DOCTYPE html>
<html lang="en">
<head>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fredoka&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<link rel="icon" type="image/png" sizes="32x32" href="https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png">
<link rel="apple-touch-icon" href="https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="uwGK_wrZ8HW1YDPlIVdaqyOErueoMH5-9DF-fXL7uSc" />
<title>Upload a mod | Bloxd World</title>
<meta name="description" content="Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd. Built by NeonJet Studios.">
<meta name="keywords" content="BloxdWorld, Bloxd mods, Bloxd.io mods, NeonJet Studios, ObiloxYT, modding, leaderboards">
<meta name="author" content="NeonJet Studios">

<meta property="og:type" content="website">
<meta property="og:site_name" content="Bloxd World">
<meta property="og:url" content="https://bloxdworld.pages.dev">
<meta property="og:title" content="Bloxd World â€“ Share and Discover Mods">
<meta property="og:description" content="Upload and explore mods for Bloxd. Vote, sort, and share your creations.">
<meta property="og:image" content="https://bloxdworld.pages.dev/THE%20PLACE%20FOR.png">
<meta property="og:image:alt" content="Bloxd World Preview Image">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Bloxd World â€“ Share and Discover Mods">
<meta name="twitter:description" content="Upload and explore mods for Bloxd. Vote, sort, and share your creations.">
<meta name="twitter:image" content="https://bloxdworld.pages.dev/THE%20PLACE%20FOR.png">

<meta name="theme-color" content="#00c3ff">

<link rel="stylesheet" href="styles/earth-cube.css">
<link rel="stylesheet" href="styles/header.css">
<link rel="stylesheet" href="styles/devlogandindex.css">
<link rel="stylesheet" href="styles/other.css">
<link rel="stylesheet" href="styles/navbar.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<script type="application/ld+json">
{
Â  "@context": "https://schema.org",
Â  "@type": "WebSite",
Â  "name": "Bloxd World",
Â  "url": "https://bloxdworld.pages.dev",
Â  "description": "Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd.",
Â  "publisher": {
Â  Â  "@type": "Organization",
Â  Â  "name": "NeonJet Studios",
Â  Â  "logo": {
Â  Â  Â  "@type": "ImageObject",
Â  Â  Â  "url": "https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png"
Â  Â  }
Â  },
Â  "potentialAction": {
Â  Â  "@type": "SearchAction",
Â  Â  "target": "https://bloxdworld.pages.dev/search?q={search_term_string}",
Â  Â  "query-input": "required name=search_term_string"
Â  }
}
</script>


<style>

.upload-container {
max-width: 800px;
margin: 40px auto;
padding: 20px;
background: white;
border-radius: 8px;
box-shadow: 0 0 15px rgba(0,0,0,0.1);
text-align: center;
}
.upload-container input[type="text"],
.upload-container input[type="file"],
.upload-container textarea,
.upload-container select {
width: 90%;
padding: 10px;
margin: 10px 0;
border-radius: 6px;
border: 1px solid #ccc;
}
.upload-container button {
padding: 12px 25px;
font-size: 1rem;
border: none;
border-radius: 6px;
background-color: #1e88e5;
color: white;
cursor: pointer;
}
.upload-container button:hover {
background-color: #1565c0;
}
</style>
</head>
<body>
<div class="modrinth-navbar">
  <div class="header">
    
    <!-- Left: Logo -->
    <div class="header-left">
      <div style="display: flex; align-items: center; height: 100%;">
        <div class="cube-container">
          <div class="cube">
            <div class="face front"></div>
            <div class="face back"></div>
            <div class="face right"></div>
            <div class="face left"></div>
            <div class="face top"></div>
            <div class="face bottom"></div>
          </div>
        </div>
      </div>
      <div class="logo-text">Bloxd<br>World</div>
    </div>

    <!-- Right: Navbar + Auth split -->
    <div class="header-right">
      <div class="navbar-wrapper">
        <ul class="navbar">
          <li class="nav-item">
            <a href="index.html"><i class="fas fa-home"></i><span class="nav-label">Home</span></a>
          </li>
          <li class="nav-item">
            <a href="mods.html"><i class="fas fa-cubes"></i><span class="nav-label">Mods</span></a>
          </li>
          <li class="nav-item">
            <a href="upload.html"><i class="fas fa-upload"></i><span class="nav-label">Upload</span></a>
          </li>
          <li class="nav-item">
            <a href="about.html"><i class="fas fa-info-circle"></i><span class="nav-label">About</span></a>
          </li>
          <li class="nav-item">
            <a href="leaderboard.html"><i class="fas fa-trophy"></i><span class="nav-label">Leaderboard</span></a>
          </li>
          <li class="nav-item">
            <a href="#" id="themeToggle"><i class="fas fa-moon"></i><span class="nav-label">Theme</span></a>
          </li>
        </ul>
      </div>
      <div class="auth-wrapper" id="authArea">
        <!-- Auth content here -->
      </div>
    </div>

  </div>
</div>

<div class="upload-container">
Â  <h2>Upload Your Mod</h2>
Â  <input type="text" id="modTitle" placeholder="Enter Mod Title"><br>
Â  <textarea id="modDescription" placeholder="Enter Mod Description"></textarea><br>
Â  <input type="text" id="modImage" placeholder="Image URL"><br>
Â  <input type="text" id="modIcon" placeholder="Icon URL"><br>
<input type="text" id="modShort" placeholder="Short Description">
<p id="wordCountMsg" style="color: red;"></p>
Â  <select id="modCategory">
Â  Â  <option value="">Select Category</option>
Â  Â  <option value="Gameplay">Gameplay</option>
Â  Â  <option value="Visual">Visual</option>
Â  Â  <option value="Utility">Utility</option>
Â  Â  <option value="Other">Other</option>
Â  </select><br>
Â  <input type="file" id="modFile"><br>
Â  <button>Upload ğŸ”¥</button>
Â  <p id="uploadStatus"></p>
</div>

<footer class="site-footer">
Â  <p>Â© NeonJet Studios. <strong>Bloxd World</strong> is made by NeonJet Studios and is not affiliated with Bloxd.io.</p>
Â  <nav class="footer-links">
Â  Â  <a href="/about">About</a>
Â  Â  <a href="/leaderboard">Leaderboard</a>
Â  Â  <a href="/upload">Submit a Mod</a>
Â  Â  <a href="https://discord.gg/yourserver" target="_blank">Join Discord (SOON)</a>
Â  </nav>
</footer>

<script type="module">
Â  console.log("Script module loaded.");
Â  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
Â  import { getProfile, uploadMod, getUID } from "./js/googlelogin.js";
Â  import * as leoProfanity from "https://cdn.jsdelivr.net/npm/leo-profanity/+esm";
Â  import * as nsfwjs from "https://cdn.jsdelivr.net/npm/nsfwjs/+esm";

const client = createClient(
Â  "https://pxmsgzfufvwxpnyeobwk.supabase.co",
Â  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bXNnemZ1ZnZ3eHBueWVvYndrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjU1OTksImV4cCI6MjA2NzM0MTU5OX0.-fRzI_259AIkq60Ck7PcgpX2SThnp8rBwVGglKxgY2U",
Â  {
Â  Â  auth: {
Â  Â  Â  persistSession: true,
Â  Â  Â  autoRefreshToken: true,
Â  Â  Â  storage: localStorage
Â  Â  }
Â  }
);

// ğŸ›¡ï¸ text moderation
function cleanImages(input) {
Â  return input.replace(/<img[^>]*>/gi, match => {
Â  Â  // Only allow http/https links
Â  Â  if (/src\s*=\s*["']?(https?:\/\/[^"'>\s]+)/i.test(match)) {
Â  Â  Â  return match; // legit img, keep it
Â  Â  }
Â  Â  return "ğŸš«"; // blocked img
Â  });
}
async function moderateImagesInDescription(html) {
Â  await loadNSFWModel(); // make sure the model is loaded
Â  const div = document.createElement("div");
Â  div.innerHTML = html;
Â  const images = div.querySelectorAll("img");

Â  for (let img of images) {
Â  Â  try {
Â  Â  Â  const imageEl = new Image();
Â  Â  Â  imageEl.crossOrigin = "anonymous";
Â  Â  Â  imageEl.src = img.src;

Â  Â  Â  await new Promise((res, rej) => {
Â  Â  Â  Â  imageEl.onload = res;
Â  Â  Â  Â  imageEl.onerror = rej;
Â  Â  Â  });

Â  Â  Â  const predictions = await nsfwModel.classify(imageEl);

Â  Â  Â  // ğŸ‘ˆ HERE: calculate nsfwScore
Â  Â  Â  const nsfwScore = predictions.find(p => 
Â  Â  Â  Â  ["Porn", "Hentai", "Sexy"].includes(p.className)
Â  Â  Â  )?.probability || 0;

Â  Â  Â  // ğŸ‘ˆ Remove or replace image if NSFW
Â  Â  Â  if (nsfwScore > 0.7) { 
Â  Â  Â  Â  img.src = "https://bloxdworld.pages.dev/assets/default-banner.png";
Â  Â  Â  Â  img.alt = "NSFW image removed";
Â  Â  Â  }

Â  Â  } catch (err) {
Â  Â  Â  console.warn("Failed to scan image:", err);
Â  Â  Â  img.replaceWith("âš ï¸ [Unscannable Image]");
Â  Â  }
Â  }

Â  return div.innerHTML;
}

function cleanText(input) {
Â  return (input || "")
Â  Â  .replace(/<\s*script[^>]*>/gi, "********")
Â  Â  .replace(/<\s*\/\s*script\s*>/gi, "********");
}

async function sanitizeDescription(input) {
Â  let safeText = cleanText(input);
Â  safeText = leoProfanity.clean(safeText); // profanity filter
Â  let moderated = await moderateImagesInDescription(safeText);
Â  return moderated;
}


// ğŸ›¡ï¸ image url validator
function validateImageURL(url) {
Â  if (!url) return false;
Â  try {
Â  Â  const u = new URL(url);
Â  Â  return ["http:", "https:"].includes(u.protocol);
Â  } catch {
Â  Â  return false;
Â  }
}

// ğŸ›¡ï¸ NSFWJS setup
let nsfwModel = null;
async function loadNSFWModel() {
Â  if (!nsfwModel) nsfwModel = await nsfwjs.load();
Â  return nsfwModel;
}
async function isImageSafe(url) {
Â  if (!validateImageURL(url)) return false;
Â  return new Promise((resolve) => {
Â  Â  const img = new Image();
Â  Â  img.crossOrigin = "anonymous";
Â  Â  img.src = url;
Â  Â  img.onload = async () => {
Â  Â  Â  try {
Â  Â  Â  Â  const model = await loadNSFWModel();
Â  Â  Â  Â  const predictions = await model.classify(img);
Â  Â  Â  Â  console.log("Image moderation:", predictions);
Â  Â  Â  Â  const unsafe = predictions.some(
Â  Â  Â  Â  Â  (p) => ["Porn", "Sexy", "Hentai"].includes(p.className) && p.probability > 0.6
Â  Â  Â  Â  );
Â  Â  Â  Â  resolve(!unsafe);
Â  Â  Â  } catch {
Â  Â  Â  Â  resolve(false);
Â  Â  Â  }
Â  Â  };
Â  Â  img.onerror = () => resolve(false);
Â  });
}

document.addEventListener("DOMContentLoaded", () => {
Â  console.log("DOM content loaded. Checking user session...");
Â  const uploadBtn = document.querySelector(".upload-container button");
Â  const status = document.getElementById("uploadStatus");
Â  const descInput = document.getElementById("modDescription");
Â  const shortInput = document.getElementById("modShort");
Â  const message = document.getElementById("wordCountMsg");

Â  // word count limiter (on short desc)
Â  shortInput.addEventListener("input", () => {
Â  Â  const words = shortInput.value.trim().split(/\s+/).filter(Boolean);
Â  Â  if (words.length > 30) {
Â  Â  Â  message.textContent = `Limit exceeded: ${words.length} words (max 30)`;
Â  Â  Â  shortInput.value = words.slice(0, 30).join(" ");
Â  Â  } else {
Â  Â  Â  message.textContent = `Words: ${words.length}/30`;
Â  Â  }
Â  });

Â  uploadBtn.addEventListener("click", async () => {
Â  Â  console.log("Upload button clicked.");
Â  Â  status.textContent = "Uploading... â³";

Â  Â  try {
Â  Â  Â  const { data: { session } } = await client.auth.getSession();
Â  Â  Â  const user = session?.user;
Â  Â  Â  console.log("User session check:", user);

Â  Â  Â  if (!user?.email) {
Â  Â  Â  Â  console.error("User not logged in.");
Â  Â  Â  Â  status.textContent = "âŒ You must be logged in to upload a mod!";
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const profile = await getProfile();
Â  Â  Â  const author = profile.display_name || user.user_metadata.display_name || user.email;
Â  Â  Â  console.log("Author:", author);

Â  Â  Â  // grab form data
Â  Â  Â  let title = document.getElementById("modTitle").value;
Â  Â  Â  let fileInput = document.getElementById("modFile");
Â  Â  Â  let file = fileInput.files[0];
Â  Â  Â  let description = document.getElementById("modDescription").value;
Â  Â  Â  let image = document.getElementById("modImage").value;
Â  Â  Â  let icon = document.getElementById("modIcon").value;
Â  Â  Â  let category = document.getElementById("modCategory").value;
Â  Â  Â  let shortdescription = document.getElementById("modShort").value;
Â  Â  Â  
Â  Â  Â  console.log("Collected form data:", {
Â  Â  Â  Â  title, file, description, image, icon, category, shortdescription
Â  Â  Â  });
Â  Â  Â  console.log("File object:", file);

Â  Â  Â  // ğŸ›¡ï¸ clean text
Â  Â  Â  title = cleanText(title);
Â  Â  Â  let desc = document.getElementById("modDescription").value;
Â  Â  Â  desc = await sanitizeDescription(desc);
Â  Â  Â  description = desc;
Â  Â  Â  shortdescription = cleanText(shortdescription);
Â  Â  Â  category = cleanText(category);

Â  Â  Â  // ğŸ›¡ï¸ moderate images
Â  Â  Â  console.log("Moderating image URLs...");
Â  Â  Â  if (!(await isImageSafe(icon))) {
Â  Â  Â  Â  console.warn("Icon image not safe. Using default.");
Â  Â  Â  Â  icon = "https://bloxdworld.pages.dev/assets/default-icon.png";
Â  Â  Â  Â  Toastify({ text: "Unsafe or invalid icon replaced with default.", backgroundColor: "orange", duration: 3000 }).showToast();
Â  Â  Â  }
Â  Â  Â  if (!(await isImageSafe(image))) {
Â  Â  Â  Â  console.warn("Banner image not safe. Using default.");
Â  Â  Â  Â  image = "https://bloxdworld.pages.dev/assets/default-banner.png";
Â  Â  Â  Â  Toastify({ text: "Unsafe or invalid banner replaced with default.", backgroundColor: "orange", duration: 3000 }).showToast();
Â  Â  Â  }

Â  Â  Â  const modData = {
Â  Â  Â  Â  title,
Â  Â  Â  Â  file,
Â  Â  Â  Â  description,
Â  Â  Â  Â  image,
Â  Â  Â  Â  icon,
Â  Â  Â  Â  author,
Â  Â  Â  Â  category,
Â  Â  Â  Â  creatoruid: getUID(),
Â  Â  Â  Â  shortdescription,
Â  Â  Â  Â  info: { extra: "submitted via form" }
Â  Â  Â  };

Â  Â  Â  console.log("Final mod data to be sent to uploadMod:", modData);
Â  Â  Â  
Â  Â  Â  // Make sure your googlelogin.js exports an uploadMod function that takes this object
Â  Â  Â  const result = await uploadMod(modData);
Â  Â  Â  
Â  Â  Â  console.log("Result from uploadMod:", result);

Â  Â  Â  if (result.error) {
Â  Â  Â  Â  status.textContent = "âŒ " + result.error;
Â  Â  Â  } else {
Â  Â  Â  Â  status.textContent = "âœ… Upload successful!";
Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  console.error("âŒ An unexpected error occurred during upload:", err);
Â  Â  Â  status.textContent = "âŒ Upload failed due to an unexpected error.";
Â  Â  }
Â  });
});

</script>

<script>
if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
Â  document.body.classList.add("mobile");
}

const themeToggle = document.getElementById("themeToggle");
if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark-mode");

themeToggle.addEventListener("click", e => {
Â  e.preventDefault();
Â  document.body.classList.toggle("dark-mode");
Â  localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module" src="js/googlelogin.js"></script>
</body> 
</html>