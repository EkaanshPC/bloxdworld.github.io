<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<title>Update Profile | Bloxd World</title>
<meta name="description" content="Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd. Built by NeonJet Studios.">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="styles/earth-cube.css">
<link rel="stylesheet" href="styles/header.css">
<link rel="stylesheet" href="styles/devlogandindex.css">
<link rel="stylesheet" href="styles/other.css">
<link rel="stylesheet" href="styles/navbar.css"> 

<style>
/* Default light mode (no .dark-mode class) */
body {
  background: #f9f9f9;
  color: #111;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}

.profile-container {
  max-width: 600px;
  margin: 50px auto;
  background: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.profile-container h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #111;
}

.profile-field label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #111;
}

.profile-field input,
.profile-field textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background: #fff;
  color: #111;
}

#profilePreview {
  display: block;
  margin: 0 auto 20px auto;
  border-radius: 50%;
  width: 120px;
  height: 120px;
  object-fit: cover;
  border: 2px solid #ccc;
}

#saveProfile {
  background: #007bff;
  color: #fff;
  border: none;
  padding: 15px;
  width: 100%;
  cursor: pointer;
  border-radius: 6px;
  transition: background 0.2s, box-shadow 0.2s;
}

#saveProfile:hover {
  background: #0056b3;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

/* Dark mode overrides */
body.dark-mode {
  background: #121212;
  color: #e0e0e0;
}

body.dark-mode .profile-container {
  background: #1e1e1e;
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

body.dark-mode .profile-container h2 {
  color: #fff;
}

body.dark-mode .profile-field label {
  color: #e0e0e0;
}

body.dark-mode .profile-field input,
body.dark-mode .profile-field textarea {
  background: #2c2c2c;
  color: #e0e0e0;
  border: 1px solid #444;
}

body.dark-mode #profilePreview {
  border: 2px solid #555;
}

body.dark-mode #saveProfile {
  background: #007bff;
}

body.dark-mode #saveProfile:hover {
  background: #0056b3;
  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

</style>
</head>
<body>
<div class="modrinth-navbar">
  <div class="header">
    <div class="header-left">
      <div style="display: flex; align-items: center; height: 100%;">
        <div class="cube-container">
          <div class="cube">
            <div class="face front"></div>
            <div class="face back"></div>
            <div class="face right"></div>
            <div class="face left"></div>
            <div class="face top"></div>
            <div class="face bottom"></div>
          </div>
        </div>
      </div>
      <div class="logo-text"> Bloxd <br>World</div>
    </div>
    <div class="header-right">
      <ul class="navbar">
        <li class="nav-item"><a href="index.html"><i class="fas fa-home"></i><span class="nav-label">Home</span></a></li>
        <li class="nav-item"><a href="mods.html"><i class="fas fa-cubes"></i><span class="nav-label">Mods</span></a></li>
        <li class="nav-item"><a href="upload.html"><i class="fas fa-upload"></i><span class="nav-label">Upload</span></a></li>
        <li class="nav-item"><a href="about.html"><i class="fas fa-info-circle"></i><span class="nav-label">About</span></a></li>
        <li class="nav-item"><a href="leaderboard.html"><i class="fas fa-trophy"></i><span class="nav-label">Leaderboard</span></a></li>
        <li class="nav-item"><a href="#" id="themeToggle"><i class="fas fa-moon"></i><span class="nav-label">Theme</span></a></li>
        <li class="nav-item" id="authArea"></li>
      </ul>
    </div>
  </div>
</div>

<div class="profile-container">
  <h2>Update Profile</h2>
  <img id="profilePreview" src="https://bloxdworld.pages.dev/assets/pixil-frame-0%20(14).png" alt="Profile Picture Preview">
  
  <div class="profile-field">
    <label for="displayName">Display Name</label>
    <input type="text" id="displayName">
  </div>
  
  <div class="profile-field">
    <label for="bio">Bio</label>
    <textarea id="bio"></textarea>
  </div>

  <div class="profile-field">
    <label for="profilePicture">Profile Picture URL</label>
    <input type="text" id="profilePicture">
  </div>

  <button id="saveProfile">Save Profile</button>
</div>

<footer class="site-footer">
  <p>© NeonJet Studios. <strong>Bloxd World</strong> is made by NeonJet Studios and is not affiliated with Bloxd.io.</p>
  <nav class="footer-links">
    <a href="/about">About</a>
    <a href="/leaderboard">Leaderboard</a>
    <a href="/upload">Submit a Mod</a>
    <a href="https://discord.gg/yourserver" target="_blank">Join Discord (SOON)</a>
  </nav>
</footer>

<script type="module">
import { getUID } from "./js/googlelogin.js";
const client = supabase.createClient(
  "https://pxmsgzfufvwxpnyeobwk.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bXNnemZ1ZnZ3eHBueWVvYndrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjU1OTksImV4cCI6MjA2NzM0MTU5OX0.-fRzI_259AIkq60Ck7PcgpX2SThnp8rBwVGglKxgY2U",
  {
    auth: {
      persistSession: true,         // ✅ Keeps user logged in across reloads
      autoRefreshToken: true,       // ✅ Refreshes JWTs automatically
      storage: localStorage         // ✅ Stores session in browser
    }
  }
);
async function loadProfile() {
  const uid = await getUID();
  if (!uid) return;

  const { data: profile, error } = await client
    .from("profiles")
    .select("*")
    .eq("uid", uid)
    .maybeSingle();

  if (error) {
    console.error(error);
    return;
  }

  if (profile) {
    document.getElementById("displayName").value = profile.display_name || "";
    document.getElementById("bio").value = profile.bio || "";
    document.getElementById("profilePicture").value = profile.profile_picture || "";
    if (profile.profile_picture) document.getElementById("profilePreview").src = profile.profile_picture;
  }
}

document.getElementById("profilePicture").addEventListener("input", (e) => {
  document.getElementById("profilePreview").src = e.target.value || "https://bloxdworld.pages.dev/assets/pixil-frame-0%20(14).png";
});

document.getElementById("saveProfile").addEventListener("click", async () => {
  const uid = await getUID();
  if (!uid) {
    Toastify({ text: "You must be logged in!", backgroundColor: "red", duration: 3000 }).showToast();
    return;
  }

  const display_name = document.getElementById("displayName").value;
  const bio = document.getElementById("bio").value;
  const profile_picture = document.getElementById("profilePicture").value;

  const { data, error } = await client
    .from("profiles")
    .upsert({ uid, display_name, bio, profile_picture }, { onConflict: ["uid"] });

  if (error) {
    Toastify({ text: "Failed to save profile!", backgroundColor: "red", duration: 3000 }).showToast();
    console.error(error);
    return;
  }

  Toastify({ text: "Profile updated!", backgroundColor: "#00ffff", duration: 3000 }).showToast();
});

loadProfile();
const themeToggle = document.getElementById("themeToggle");

// Apply saved theme on load
if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark-mode");
}

// Toggle and save preference
themeToggle.addEventListener("click", (e) => {
  e.preventDefault();
  document.body.classList.toggle("dark-mode");

  // Save preference
  if (document.body.classList.contains("dark-mode")) {
    localStorage.setItem("theme", "dark");
  } else {
    localStorage.setItem("theme", "light");
  }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module" src="js/googlelogin.js"></script>
</body>
</html>
