<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Approve Mod Versions | Bloxd World</title><link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><style>body{font-family:Fredoka,sans-serif;background:#f0f0f0;margin:0;padding:20px}h1{text-align:center;color:#007c7e}.mod-card{display:flex;flex-direction:row;background:#fff;border-radius:8px;padding:20px;margin:20px auto;box-shadow:0 0 10px rgba(0,0,0,.1);gap:20px;max-width:900px}.mod-icon{width:140px;height:140px;object-fit:cover;border-radius:10px}.mod-content{display:flex;flex-direction:column;gap:10px;flex:1}.mod-meta p{margin:0}button{padding:8px 12px;font-size:14px;border:none;border-radius:6px;cursor:pointer;transition:background .2s}.approve-btn{background:#00c200;color:#fff}.reject-btn{background:#f44;color:#fff}.approve-btn:hover{background:#00e600}.reject-btn:hover{background:#f66}</style></head><body><h1>Mod Versions Approval Dashboard</h1><div id="versions-list">Checking access...</div><script type="module">import{createClient}from"https://esm.sh/@supabase/supabase-js";const supabaseUrl="https://pxmsgzfufvwxpnyeobwk.supabase.co",supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bXNnemZ1ZnZ3eHBueWVvYndrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjU1OTksImV4cCI6MjA2NzM0MTU5OX0.-fRzI_259AIkq60Ck7PcgpX2SThnp8rBwVGglKxgY2U",client=createClient(supabaseUrl,supabaseKey),ADMIN_EMAIL="ekaanshagarwal19564@gmail.com";async function debugSelectOnly(){console.log("üîç [debugSelectOnly] Testing raw select...");const{data:e,error:n}=await client.from("versions").select("\n      *,\n      mod:mod_id(id,title,shortdescription,file_path,icon,image)\n    ");n?console.error("‚ùå [debugSelectOnly] Error:",n):(console.log("‚úÖ [debugSelectOnly] Raw select returned:"),console.table(e))}async function fetchPendingVersions(){console.log("üîç [fetchPendingVersions] Starting fetch..."),await debugSelectOnly();const{data:e,error:n}=await client.from("versions").select("\n      *,\n      mod:mod_id(id,title,shortdescription,file_path,icon,image)\n    ").eq("approved",!1).order("created_at",{ascending:!1});return n?(console.error("‚ùå [fetchPendingVersions] Error fetching versions:",n),[]):e&&0!==e.length?(console.log(`‚úÖ [fetchPendingVersions] Found ${e.length} versions:`),console.table(e),e):(console.warn("‚ö†Ô∏è [fetchPendingVersions] No pending versions found."),[])}function renderVersions(e){const n=document.getElementById("versions-list");n.innerHTML="",e&&0!==e.length?e.forEach(e=>{const o=document.createElement("div");o.className="mod-card",o.innerHTML=`\n      <img src="${e.mod.icon||e.mod.image||"https://bloxdworld.pages.dev/assets/pixil-frame-0%20(14).png"}" class="mod-icon">\n      <div class="mod-content">\n        <h3>${e.mod.title} (Proposed Update)</h3>\n        <div class="mod-meta">\n          <p><b>Current Title:</b> ${e.mod.title}</p>\n          <p><b>Proposed Title:</b> ${e.proposed_title}</p>\n          <p><b>Current Description:</b> ${e.mod.shortdescription||"No description"}</p>\n          <p><b>Proposed Description:</b> ${e.proposed_description||"No description"}</p>\n          <p><b>Current File:</b> ${e.mod.file_path}</p>\n          <p><b>Proposed File:</b> ${e.proposed_file_path}</p>\n        </div>\n        <div>\n          <button class="approve-btn" onclick="approveVersion(${e.id})">‚úÖ Approve</button>\n          <button class="reject-btn" onclick="rejectVersion(${e.id})">‚ùå Reject</button>\n        </div>\n      </div>\n    `,n.appendChild(o)}):n.innerHTML="<p>No pending versions to approve!</p>"}window.approveVersion=async e=>{const{data:n,error:o}=await client.from("versions").select("*").eq("id",e).single();if(o)return alert("Error fetching version: "+o.message);const{error:t}=await client.from("mod").update({title:n.proposed_title,shortdescription:n.proposed_description,file_path:n.proposed_file_path}).eq("id",n.mod_id);if(t)return alert("Error updating mod: "+t.message);const{error:r}=await client.from("versions").delete().eq("id",e);if(r)return alert("Error deleting version: "+r.message);document.querySelector(`.mod-card[data-id="${e}"]`)?.remove(),alert("‚úÖ Version approved and mod updated!")},window.rejectVersion=async e=>{const{error:n}=await client.from("versions").delete().eq("id",e);if(n)return alert("‚ùå Error rejecting version: "+n.message);document.querySelector(`.mod-card[data-id="${e}"]`)?.remove(),alert("‚ùå Version rejected!")},document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:e}}=await client.auth.getSession(),n=e?.user;if(!n||n.email!==ADMIN_EMAIL)return void(document.getElementById("versions-list").innerHTML="<p>‚ùå Access Denied. Only admin can view this page.</p>");renderVersions(await fetchPendingVersions())})</script></body></html>